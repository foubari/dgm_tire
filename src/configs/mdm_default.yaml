# Default configuration for MDM (Multinomial Diffusion Model)

model:
  type: mdm
  image_size: [64, 32]  # [H, W]
  dim: 64  # Base dimension for UNet
  dim_mults: [1, 2, 4]  # Channel multipliers for UNet
  num_classes: 6  # Number of classes (5 components + background)
  # cond_dim: auto-calculated from len(condition_columns) if not specified
  timesteps: 500  # Number of diffusion timesteps
  loss_type: "vb_stochastic"  # Options: "vb_stochastic" or "vb_all"
  cond_drop_prob: 0.1  # Classifier-free guidance dropout probability

data:
  root_dir: "data/epure/"  # Relative to project root
  condition_csv: "data/epure/preprocessed/performances.csv"  # CSV file with conditioning data
  condition_columns: ["d_cons", "d_rigid", "d_life", "d_stab"]  # Performance metrics columns
  prefix_column: "matching"  # Column name containing prefix/ID
  split_column: "train"  # Column name for train/test split
  resolution: [64, 32]  # [H, W] for masks
  mask_format: "numpy"  # "numpy" to load from .npy, "images" to load from files
  mask_path: null  # Path to .npy file (if mask_format="numpy") or directory (if "images")
  filename_pattern: "{prefix}.png"  # For image format
  normalized: false  # Use normalized versions of condition columns

training:
  epochs: 1000
  batch_size: 64
  num_workers: 4
  lr: 0.0001
  eval_every: 100  # Evaluate every N epochs
  check_every: 100  # Save checkpoint every N epochs
  seed: 0

paths:
  output_dir: "outputs/mdm/"  # Relative to project root
  samples_dir: "samples/mdm/"  # Relative to project root

sampling:
  num_samples: 16
  batch_sz: 8
  guidance_scale: 2.0
  mode: conditional  # unconditional, conditional, or inpainting
  components: ["fpu", "group_nc", "group_km"]  # For inpainting mode

